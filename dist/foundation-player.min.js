(function(){var t=[].slice;!function(e,r){"use strict";var n;return n=function(){function t(t,n){this.options=e.extend({},this.defaults,n),this.$wrapper=e(t),this.$player=this.$wrapper.children(".player"),this.$play=this.$wrapper.find(".player-button.play em"),this.$rewind=this.$wrapper.find(".player-button.rewind em"),this.$volume=this.$wrapper.find(".player-button.volume em"),this.$elapsed=this.$wrapper.find(".player-status.time .elapsed"),this.$remains=this.$wrapper.find(".player-status.time .remains"),this.$progress=this.$wrapper.find(".player-progress .progress"),this.$played=this.$progress.find(".progress-meter.played"),this.$sources=this.$wrapper.children("audio"),this.audio=this.$sources.get(0),this.played=0,this.nowdragging=!1,this.currentUISize=this.options.playerUISize,this.canPlayCurrent=!1,this.dataLinks=[],this.audioError=null,this.iOS=/iPad|iPhone|iPod/.test(navigator.userAgent)&&!r.MSStream,this.resetClassAndStyle(),this.setUpCurrentAudio(),this.setUpButtonPlayPause(),this.setUpButtonVolume(),this.setUpButtonRewind(),this.setUpPlayedProgress(),this.options.useSeekData&&this.parseDataLinks()}var n,i,s,a,o,u;return t.prototype.defaults={playOnLoad:!1,skipSeconds:10,dimmedVolume:.25,pauseOthersOnPlay:!0,useSeekData:!1,playerUISize:"normal",classPlayDefault:"fi-music",classPlayWait:"fi-clock",classPlayPaused:"fi-pause",classPlayPlaying:"fi-play",classPlayError:"fi-alert",classVolumeOn:"fi-volume",classVolumeOff:"fi-volume-strike",canPlayCallback:function(){return!0}},t.prototype.playPause=function(){return this.audio.paused?this.play():this.pause()},t.prototype.play=function(){return this.options.pauseOthersOnPlay&&this.getPlayerInstances().map(function(t){return function(e){return t!==e?e.pause():void 0}}(this)),this.audio.play(),this.updateButtonPlay()},t.prototype.pause=function(){return this.audio.pause(),this.updateButtonPlay()},t.prototype.seekToTime=function(t){return this.canPlayCurrent&&(t=s(t),t>this.audio.duration&&(t=this.audio.duration),this.audio.currentTime=t,this.updatePlayedProgress(),this.updateTimeStatuses()),this},t.prototype.seekPercent=function(t,e){var r;return this.canPlayCurrent&&(r=this.audio.duration*i(t),this.audio.currentTime=r||0,this.updatePlayedProgress(),this.updateTimeStatuses(),"function"==typeof e&&e()),this},t.prototype.resetClassAndStyle=function(){return this.$wrapper.addClass(this.options.playerUISize),this.setPlayerSizeHandler()},t.prototype.setUpCurrentAudio=function(){var t;return this.audio.load(),this.audio.preload="auto",t=e(this.audio),t.on("timeupdate.zf.player",function(t){return function(){return t.updatePlayedProgress(),t.updateTimeStatuses()}}(this)),t.on("loadstart.zf.player",function(t){return function(){return t.canPlayCurrent=!1,t.updateDisabledStatus(),t.updateButtonPlay()}}(this)),t.on("durationchange.zf.player",function(t){return function(){return t.updateTimeStatuses()}}(this)),t.on("progress.zf.player",function(t){return function(){return t.redrawBufferizationBars(),t.updateDisabledStatus()}}(this)),t.on("canplay.zf.player",function(t){return function(){return t.canPlayCurrent=!0,t.options.canPlayCallback(),t.options.playOnLoad&&t.play(),t.redrawBufferizationBars(),t.updateDisabledStatus(),t.updateButtonPlay()}}(this)),t.children("source").on("error",function(t){return function(e){return t.handleAudioError()}}(this)),t.on("error",function(t){return function(e){return t.handleAudioError()}}(this))},t.prototype.setUpButtonPlayPause=function(){return this.$play.bind("click",function(t){return function(){return t.canPlayCurrent?t.playPause():void 0}}(this))},t.prototype.updateButtonPlay=function(){return this.$play.toggleClass(this.options.classPlayWait,!this.canPlayCurrent&&!this.audioError),this.$play.toggleClass(this.options.classPlayPaused,this.audio.paused&&this.canPlayCurrent),this.$play.toggleClass(this.options.classPlayPlaying,!this.audio.paused),this.$play.toggleClass(this.options.classPlayError,this.audioError),this.$play.removeClass(this.options.classPlayDefault),this},t.prototype.setUpButtonVolume=function(){return this.iOS?this.$wrapper.find(".player-button.volume").hide():this.$volume.bind("click.zf.player",function(t){return function(){return t.buttonVolumeHandler()}}(this))},t.prototype.updateButtonVolume=function(){return this.$volume.toggleClass(this.options.classVolumeOff,this.audio.muted),this.$volume.toggleClass(this.options.classVolumeOn,!this.audio.muted)},t.prototype.buttonVolumeHandler=function(){return this.toggleMute(),this.updateButtonVolume()},t.prototype.setUpButtonRewind=function(){return this.$rewind.on("click",function(t){return function(){return t.seekToTime(t.audio.currentTime-t.options.skipSeconds)}}(this))},t.prototype.setUpPlayedProgress=function(){var t;return this.$played.css("width",this.played+"%"),this.$progress.on("click.zf.player",function(t){return function(e){return t.seekPercent(Math.floor(100*e.offsetX/t.$progress.outerWidth()))}}(this)),this.$progress.on("mousedown.zf.player",function(t){return function(){return t.nowdragging=!0,t.setVolume(t.options.dimmedVolume)}}(this)),t=function(t){return function(){return t.nowdragging?(t.nowdragging=!1,t.setVolume(1)):void 0}}(this),this.$player.on("mouseleave.zf.player",function(){return t()}),e(document).on("mouseup.zf.player",function(){return t()}),e(r).on("blur.zf.player",function(){return t()}),this.$progress.on("mousemove.zf.player",function(t){return function(e){return t.nowdragging?t.seekPercent(Math.floor(100*e.offsetX/t.$progress.outerWidth())):void 0}}(this))},t.prototype.updatePlayedProgress=function(){return this.played=Math.round(this.audio.currentTime/this.audio.duration*100),this.$played.css("width",this.played+"%")},t.prototype.redrawBufferizationBars=function(){var t,e,r,n,i,s,a,o;if(this.$progress.find(".buffered").remove(),a=this.audio.buffered.length,a>0){for(o=this.$progress.width(),s=[],n=r=0,i=a;i>=0?i>r:r>i;n=i>=0?++r:--r)t=this.audio.buffered.start(n),e=this.audio.buffered.end(n),s.push(u(this.$played.clone(),"buffered","played").css("left",o*Math.floor(t/this.audio.duration)+"px").width(Math.floor(o*(e-t)/this.audio.duration)).appendTo(this.$progress));return s}},t.prototype.setVolume=function(t){return this.audio.volume=t},t.prototype.toggleMute=function(){return this.audio.muted=!this.audio.muted},t.prototype.updateTimeStatuses=function(){return this.updateStatusElapsed(),this.updateStatusRemains()},t.prototype.updateStatusElapsed=function(){return this.$elapsed.text(a(this.audio.currentTime))},t.prototype.updateStatusRemains=function(){return this.$remains.text("-"+a(this.audio.duration-this.audio.currentTime))},t.prototype.updateDisabledStatus=function(){return this.$player.toggleClass("disabled",!this.canPlayCurrent)},t.prototype.togglePlayerSize=function(){var t;return t="normal"===this.currentUISize?"small":"normal",this.setPlayerSize(t)?this.currentUISize=t:void 0},t.prototype.setPlayerSize=function(t){return t!==this.currentUISize?"normal"===t||"small"===t?(u(this.$wrapper,t,this.currentUISize),this.setPlayerSizeHandler(),this.currentUISize=t):!1:void 0},t.prototype.setPlayerSizeHandler=function(){return this.playerBeautifyProgressBar(),this.redrawBufferizationBars()},t.prototype.playerBeautifyProgressBar=function(){var t;return this.$progress.hasClass("round")?(t=this.$progress.height()/2,this.$played.css("padding","0 "+t+"px"),this.$progress.find(".buffered").css("padding","0 "+t+"px")):void 0},t.prototype.getPlayerInstances=function(){return e.data(document.body,"FoundationPlayers")},t.prototype.parseDataLinks=function(){var t,r,n;return this.dataLinks=[],n=e("[data-seek-to-time]"),r=e("[data-seek-to-percentage]"),t=function(t){return function(r,n,i,s){var a;return a="click.zf.player.seek",e.each(r,function(r,o){var u;return(u=n(e(o).data(i)))?(t.dataLinks.push(o),e(o).off(a).on(a,t,function(t){return t.data[s](u)&&t.preventDefault()})):void 0})}}(this),t(n,s,"seek-to-time","seekToTime"),t(r,i,"seek-to-percentage","seekPercent")},t.prototype.handleAudioError=function(){return this.audioError=!0,this.updateButtonPlay()},t.prototype.onCanPlay=function(t){return this.options.canPlayCallback=t},u=function(t,r,n){return e(t).addClass(r).removeClass(n)},a=function(t){var e,r;return n(t)?(e=Math.floor(t/60),r=t-60*e,o(e,"0",2)+":"+o(Math.floor(r/1),"0",2)):!1},o=function(t,e,r){return(new Array(r+1).join(e)+t).slice(-r)},n=function(t){return"number"==typeof t&&isFinite(t)},s=function(t){var e;return n(t)?t:(e=t.match(/^(\d{1,})$/))?e[1]:(e=t.match(/^(\d?\d):(\d\d)$/))?60*parseInt(e[1],10)+parseInt(e[2],10):!1},i=function(t){return n(t)?0>t?0:t>100?1:t>1?t/100:t:n(t)},t}(),e.fn.extend({foundationPlayer:function(){var r,i;return i=arguments[0],r=2<=arguments.length?t.call(arguments,1):[],e.data(document.body,"FoundationPlayers")||e.data(document.body,"FoundationPlayers",[]),this.each(function(){var t;return e.data(this,"FoundationPlayer")?void 0:(t=new n(this,i),e.data(this,"FoundationPlayer",t),e.data(document.body,"FoundationPlayers").push(t))})}})}(window.jQuery,window)}).call(this);